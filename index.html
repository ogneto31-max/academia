<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Controle de Ganho de Massa</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  :root{
    --bg:#0f172a;        /* slate-900 */
    --card:#0b1226;      /* dark card */
    --muted:#94a3b8;     /* slate-400 */
    --text:#e2e8f0;      /* slate-200 */
    --primary:#22c55e;   /* green-500 */
    --primary-600:#16a34a;
    --accent:#38bdf8;    /* sky-400 */
    --danger:#ef4444;    /* red-500 */
    --warn:#f59e0b;      /* amber-500 */
  }
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(180deg,#0b1020,#0f172a);color:var(--text);margin:0}
  .wrap{max-width:1100px;margin:0 auto;padding:24px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
  h1{font-size:24px;margin:0;letter-spacing:.2px}
  .meta{color:var(--muted);font-size:14px}

  /* Tabs */
  .tabs{display:flex;gap:10px;flex-wrap:wrap}
  .tab{border:none;background:#0e162e;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600;transition:.2s;border:1px solid #1f2a44}
  .tab.active{background:var(--primary-600)}

  /* Card */
  .card{background:linear-gradient(180deg,#0b1226,#0a0f20);border:1px solid #1f2a44;border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);}

  /* Table */
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{border-bottom:1px solid #1f2a44;padding:10px;text-align:center}
  th{color:#cbd5e1;font-weight:700;background:#0e162e;position:sticky;top:0}
  tr:hover td{background:#0e152d}
  input[type="checkbox"]{transform:scale(1.25)}
  input[type="number"]{width:92px;background:#0e162e;border:1px solid #1f2a44;color:var(--text);padding:8px 10px;border-radius:10px}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
  .btn{background:#0e162e;color:var(--text);border:1px solid #1f2a44;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
  .btn.primary{background:var(--primary-600);border-color:transparent}
  .btn.danger{background:transparent;border-color:var(--danger);color:var(--danger)}

  /* Progress pill */
  .pill{height:10px;background:#122046;border-radius:999px;overflow:hidden;border:1px solid #1f2a44}
  .pill > span{display:block;height:100%;background:linear-gradient(90deg,var(--danger),var(--warn),var(--primary));width:0%}

  /* Sections */
  .section{display:none;margin-top:16px}
  .section.active{display:block}
  h2{margin:0 0 10px 0;font-size:18px}
  .grid{display:grid;gap:12px}
  .grid-2{grid-template-columns:1fr 1fr}
  .day{border:1px solid #1f2a44;border-radius:14px;padding:14px;background:#0e162e}
  .day h3{margin:0 0 6px 0;font-size:16px}
  ul{margin:6px 0 0 18px;}
  li{margin:4px 0}
  .kcal{color:var(--muted);font-size:13px}
  .muted{color:var(--muted)}
  .badge{display:inline-block;padding:3px 8px;border-radius:999px;font-size:12px;border:1px solid #1f2a44;background:#0e162e}

  canvas{background:#0e162e;border:1px solid #1f2a44;border-radius:12px;padding:8px}

  /* Dropdown Mês/Ano */
  #monthSelect{background:#0e162e;color:var(--text);border:1px solid #1f2a44;padding:6px 10px;border-radius:8px;font-weight:600;margin-right:10px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>📈 Controle de Ganho de Massa</h1>
    <div class="meta" id="meta"></div>
  </header>

  <div class="tabs">
    <button class="tab active" data-tab="diario">Diário (checklist & peso)</button>
    <button class="tab" data-tab="alimentacao">Plano Alimentar (7 dias)</button>
    <button class="tab" data-tab="treino">Plano de Treinamento (7 dias)</button>
  </div>

  <!-- DIÁRIO -->
  <section id="diario" class="section active card">
    <div class="controls">
      <label for="monthSelect">Mês/Ano:</label>
      <select id="monthSelect"></select>
      <button class="btn primary" id="mark-today">Marcar tudo de hoje</button>
      <button class="btn" id="unmark-today">Desmarcar hoje</button>
      <button class="btn danger" id="reset">Resetar dados</button>
    </div>
    <div class="muted">Marque cada refeição e o treino realizado. O % do dia usa 7 itens: treino + 6 refeições.</div>
    <table id="tbl">
      <thead>
        <tr>
          <th>Data</th>
          <th>Treino</th>
          <th>Café</th>
          <th>Lanche manhã (hiper)</th>
          <th>Almoço</th>
          <th>Lanche tarde</th>
          <th>Jantar</th>
          <th>Ceia (hiper)</th>
          <th>% Dia</th>
          <th>Peso (kg)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="grid grid-2" style="margin-top:14px">
      <div>
        <h2>📊 Evolução do Peso</h2>
        <canvas id="pesoChart" height="220"></canvas>
      </div>
      <div>
        <h2>✅ Cumprimento Diário</h2>
        <canvas id="cumprimentoChart" height="220"></canvas>
      </div>
    </div>
  </section>

  <!-- ALIMENTAÇÃO DETALHADA (7 DIAS) -->
  <section id="alimentacao" class="section card">
    <!-- ... seu conteúdo de plano alimentar permanece inalterado ... -->
  </section>

  <!-- TREINAMENTO DETALHADO (7 DIAS) -->
  <section id="treino" class="section card">
    <!-- ... seu conteúdo de plano treino permanece inalterado ... -->
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const metaEl = document.getElementById('meta');
metaEl.textContent = new Date().toLocaleDateString('pt-BR', {weekday:'long', day:'2-digit', month:'2-digit'});

// Tabs
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
  })
})

// ---------- Dropdown de Mês/Ano ----------
const monthSelect = document.getElementById('monthSelect');
function populateMonths(){
  const now = new Date();
  const end = new Date(2030,11,1);
  let current = new Date(now.getFullYear(), now.getMonth(),1);
  while(current <= end){
    const opt = document.createElement('option');
    opt.value = `${current.getFullYear()}-${current.getMonth()}`;
    opt.textContent = current.toLocaleString('pt-BR',{month:'long',year:'numeric'});
    monthSelect.appendChild(opt);
    current.setMonth(current.getMonth()+1);
  }
}
populateMonths();

// ---------- Diário ----------
const tbody = document.querySelector('#tbl tbody');

function emptyRow(date){return {date, treino:false, cafe:false, lm:false, almoco:false, lt:false, jantar:false, ceia:false, peso:""};}

// LocalStorage por mês
function getKey(){return 'ganhoMassa_'+monthSelect.value;}
function loadState(){return JSON.parse(localStorage.getItem(getKey())||'[]');}
function saveState(state){localStorage.setItem(getKey(),JSON.stringify(state));}

function buildTable(){
  const [year, month] = monthSelect.value.split('-').map(Number);
  const daysInMonth = new Date(year,month+1,0).getDate();
  const state = loadState();
  tbody.innerHTML='';
  for(let i=1;i<=daysInMonth;i++){
    const d = new Date(year,month,i);
    const date = d.toLocaleDateString('pt-BR');
    const row = state[i-1] || emptyRow(date);
    const tr = document.createElement('tr');
    tr.innerHTML=`
      <td>${date}</td>
      <td><input type="checkbox" ${row.treino?'checked':''} data-k="treino"></td>
      <td><input type="checkbox" ${row.cafe?'checked':''} data-k="cafe"></td>
      <td><input type="checkbox" ${row.lm?'checked':''} data-k="lm"></td>
      <td><input type="checkbox" ${row.almoco?'checked':''} data-k="almoco"></td>
      <td><input type="checkbox" ${row.lt?'checked':''} data-k="lt"></td>
      <td><input type="checkbox" ${row.jantar?'checked':''} data-k="jantar"></td>
      <td><input type="checkbox" ${row.ceia?'checked':''} data-k="ceia"></td>
      <td>
        <div class="pill"><span style="width:${pct(row)}%"></span></div>
        <div class="muted" style="font-size:12px">${Math.round(pct(row))}%</div>
      </td>
      <td><input type="number" step="0.1" value="${row.peso}" data-k="peso"></td>
    `;
    tbody.appendChild(tr);
  }
  saveState(readTable());
  drawCharts(readTable());
}

// ---------- Funções gerais ----------
function pct(row){return (['treino','cafe','lm','almoco','lt','jantar','ceia'].filter(k=>row[k]).length/7*100);}
function readTable(){return [...tbody.querySelectorAll('tr')].map(tr=>{
  const date = tr.children[0].textContent;
  const get = (sel)=> tr.querySelector(sel);
  return {date, treino:get('[data-k="treino"]').checked, cafe:get('[data-k="cafe"]').checked, lm:get('[data-k="lm"]').checked, almoco:get('[data-k="almoco"]').checked, lt:get('[data-k="lt"]').checked, jantar:get('[data-k="jantar"]').checked, ceia:get('[data-k="ceia"]').checked, peso:get('[data-k="peso"]').value};
})}

function refreshPills(){[...tbody.querySelectorAll('tr')].forEach((tr,i)=>{const w=Math.round(pct(readTable()[i])); tr.querySelector('.pill > span').style.width=w+'%'; tr.querySelector('.muted').textContent=w+'%';})}

// ---------- Eventos ----------
tbody.addEventListener('change',()=>{saveState(readTable()); refreshPills(); drawCharts(readTable());});
monthSelect.addEventListener('change',buildTable);

document.getElementById('reset').addEventListener('click',()=>{
  if(confirm('Tem certeza que deseja apagar todos os dados?')){
    localStorage.removeItem(getKey());
    buildTable();
  }
});

document.getElementById('mark-today').addEventListener('click',()=>{
  const today = new Date();
  const [year, month] = monthSelect.value.split('-').map(Number);
  if(today.getFullYear()===year && today.getMonth()===month){
    const tr = tbody.querySelector(`tr:nth-child(${today.getDate()})`);
    if(tr) tr.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=true);
    saveState(readTable()); refreshPills(); drawCharts(readTable());
  }
});

document.getElementById('unmark-today').addEventListener('click',()=>{
  const today = new Date();
  const [year, month] = monthSelect.value.split('-').map(Number);
  if(today.getFullYear()===year && today.getMonth()===month){
    const tr = tbody.querySelector(`tr:nth-child(${today.getDate()})`);
    if(tr) tr.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=false);
    saveState(readTable()); refreshPills(); drawCharts(readTable());
  }
});

// Charts
let pesoChart, compChart;
function drawCharts(state){
  const labels = state.map(r=>r.date);
  const pesos = state.map(r=> r.peso? Number(r.peso): null);
  const comp = state.map(r=> Math.round(pct(r)) );

  const ctx1 = document.getElementById('pesoChart').getContext('2d');
  if(pesoChart) pesoChart.destroy();
  pesoChart = new Chart(ctx1, {type:'line', data:{labels, datasets:[{label:'Peso (kg)', data:pesos, borderColor:'#38bdf8', backgroundColor:'rgba(56,189,248,.2)', tension:.3, spanGaps:true}]}, options:{plugins:{legend:{labels:{color:'#e2e8f0'}}}, scales:{x:{ticks:{color:'#94a3b8'}},y:{ticks:{color:'#94a3b8'}}}}});

  const ctx2 = document.getElementById('cumprimentoChart').getContext('2d');
  if(compChart) compChart.destroy();
  compChart = new Chart(ctx2, {type:'bar', data:{labels, datasets:[{label:'% do dia', data:comp, backgroundColor:'rgba(34,197,94,.6)'}]}, options:{plugins:{legend:{labels:{color:'#e2e8f0'}}}, scales:{x:{ticks:{color:'#94a3b8'}},y:{beginAtZero:true,max:100,ticks:{color:'#94a3b8'}}}}});
}

// Init
const now = new Date();
monthSelect.value = `${now.getFullYear()}-${now.getMonth()}`;
buildTable();
</script>
</body>
</html>
